{% extends "./_base.html" %}
{% block content %}
<div>
  <div class='message'>
    このボタンで更新プログラムが実行されます。 ==>
    <button class="btn btn-primary construct">更新</button>
  </div>
  <p class="message">しばらくお待ち下さい。約4000件（フォロワーとフレンドの合計数）で１分位かかります。</p>
</div>

<table class="table table-striped">
  <h3>History</h3>
  <thead>
    <tr>
      <th>modified_at</th>
      <th>proccess_time</th>
      <th>created_count</th>
      <th>updated_count</th>
    </tr>
  </thead>
  <tbody>
    {% for recode in recodes  %}
    <tr>
      <td>{{ recode.modified_at }}</td>
      <td>{{ recode.p_time }}</td>
      <td>{{ recode.created_count }}</td>
      <td>{{ recode.updated_count }}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}

{% block script %}
<script>
 $(document).on('click', 'button.construct', function(event){
   $('div.message').html('<div class="message spinner-border" role="status"><span class="sr-only">Loading...</span></div>');
   $.ajax({
     url: '{% url "tuc" %}',
     method: 'POST',
     data:{},
     success: function(){
       $('div.message').html('<div class="message">更新が終わりました。<a href="/user/top">トップページ</a>に移ってください。</div>');
       $('p.message').html('')
     }
   })
 });
</script>
{% endblock %}
